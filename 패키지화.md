구조도에 맞도록 \__init__.py 를 확실히 설정하고

setup.py 에서 파일을 포함, MANIFEST.in 에서 파일을 포함하는 등의 세팅이 확실히 되어야함

setup.py 파일 실행시 생기는 dist 및 build 파일을 완전히 삭제하고 다시 실행하는게 꼬이는 문제가 발생하지 않는것 같음 (아마도)

# 구조도

```python
# 구성도 예시
mypackage  	# 제일 상위 폴더
│── mypackage  # 패키지 구성 하위 폴더 (상위 폴더랑 동일한 명칭, pip install 할때의 이름이 아닌 실제 코드상에서 import 할때 사용할 이름)
│   ├── dir1 # 모듈로 사용하지 않는 디렉토리
│   │   └── temp.json
│   ├── module1	# 서브모듈
│   │   ├── __init__.py  # module1 을 서브모듈로 활용시 __init__.py 필요
│   │   ├── code1.py  
│   │   └── temp.json
│   ├── module2/
│   │   ├── __init__.py  
│   │   └── code2.py  
│   ├── __init__.py  # 패지키 설정 파일
│   └── contents.py  
│── .pypirc		# PyPI 토큰, 키 등 설정용
│── MANIFEST.in		# 필요한 파일 등록용
│── pyproject.toml        # 빌드 시스템 설정 파일
│── README.md             # 패키지 설명 파일
│── requirements.txt      # 필요한 패키지 목록 (선택 사항)
│── setup.py              # 설치 정보를 포함하는 파일
└── LICENSE               # 라이선스 파일 (선택 사항)
```

contents.py

```python
__all__ = ['foo', 'bar']
def foo():
	print('foo')
    
def bar():
    print('bar')
```

module1/code1.py

```python
__all__ = ['hello']
def hello():
    print('hello')

def _secret_func():
    print('secret')
```



## 패키지화 순서

1. 위의 구조도 형태로 파일 생성
2. **\__init__.py 작성**
3. 각 모듈 code 별 설정 
4. **setup.py 작성**
5. MANIFEST.in 작성 (모듈 내 리소스 활용시)
6. dist 폴더 생성
7. PyPI 업로드 (배포 시)

## \__init__.py 작성

mypackage 바로 하위의 `__init__.py` 와 서브모듈 안의 `__init__.py` 의 역할이 다름. 예시 구조도를 바탕으로 설명

### contents.py 의 함수 사용

```python
from .contents import *
```

※ `__all__` 의 경우 `import *` 을 했을때 export 할 함수를 지정가능함

### contents.py 를 그대로 사용

```python
from . import contents
```



### code1.py 의 함수 사용

1. `mypackage/__init__.py` 에 명시하는 경우

```python
from .module1.code1 import *
```

이 경우 `import mypackage` 를 통해 `mypackage.hello` 형태로 `code1.py` 내부 함수 바로 활용 가능. 
단, `module1/__init__.py` 에 설정 되어있지 않기에 `from mypackage.module1 import hello` 는 불가능함.

```python
from mypackage import hello  # --> 가능
from mypackage.module1 import hello # --> 불가능
```



2. `mypackage/module1/__init__.py` 에 명시하는 경우

```python
from .code1 import *
```

이 경우 `import mypackage.module1` 을 통해 `code1.py` 내부 함수 활용 가능.
최상위 (mypackage) 에서는 사용 불가능하며 module1 까지 접근 필요

```python
from mypackage import hello  # --> 불가능
from mypackage.module1 import hello # --> 가능
```



3.  최상위, 서브모듈 모든곳의 `__init__.py` 에 명시하는 경우

두가지 방법을 다 적용해서 최상위, 서브모듈의 `__init__.py` 에 전부 명시하면 어느 깊이에서도 사용이 가능해짐.
module1 을 직접 사용할 필요가 있는지, 함수에만 접근하면되는지 등의 상황을 고려하여 원하는 방식으로 적용

```python
# mypackage/__init__.py
from .module1.code1 import *

# mypackage/module1/__init__.py
from .code1 import *
```

```python
from mypackage import hello  # --> 가능
from mypackage.module1 import hello # --> 가능
```



3. 연쇄 import

최상위 `__init__.py` 과 서브모듈 `__init__.py` 에서 연쇄적으로 import 해서 활용하는 방식

```python
# mypackage/__init__.py
from .module1 import hello

# mypackage/module1/__init__.py
from .code1 import hello
```

이때 서브모듈 `__init__.py` 에 import 하지 않으면 에러가 발생하기에 애초에 활용 불가

서브모듈안에 서브모듈이 반복적으로 생겨도 기본적인 설정 매커니즘은 동일하다.

### code1.py 를 import

함수만을 import 하는 것이 아니라 해당 코드 파일을 그 자체로 import 하려는 경우 연쇄 export 설정 방식으로 `__init__.py` 를 설정해줘야만 가능하며 최상위 `__init__.py` 에만 설정하는 방식은 불가능하다.

```python
# mypackage/__init__.py
from .module1 import code1

# mypackage/module1/__init__.py
import code1
```

이 방식의 경우 `code1.py` 내부의 `__all__` 설정과는 무관하게 모든 함수를 import 가능해짐

## 모듈 code 별 설정

다른 서브모듈의 파일을 import 하는 경우

```python
# code1.py
from mypackage.module2.code2 import hello2
from mypackage.module2 import code2
# 절대 경로 설정으로 둘다 가능. __init__.py 설정 불필요
```

다른 디렉토리 내의 파일을 활용하는 경우

```python
import json
from importlib.resources import files

def load_data():
    path = files(__package__).joinpath("temp.json")
    with open(path, 'r') as f:
        data = json.load(f)
    return data
```



## setup.py 작성

```python
from setuptools import setup, find_packages

setup(
    name="name",  # 패키지 이름 (pip install 시 사용될 이름)
    version="version", # 버전(0.1.0)
    packages=find_packages(),  # 폴더 내 모든 패키지 포함
    include_package_data=True,  # 이 설정을 통해 패키지 내 데이터 파일을 포함시킬 수 있음
    package_data={
        'package_name':['*.pyc'],
        'package_name.module1':['temp.json'],	# module1 이 하나의 서브패키지인 경우. module1 폴더 하위에 __init__.py 필수
        'package_name':['module1/temp.json']	# module1 이 단순 하위 디렉토리인경우. static 파일 구조에 적합함
    },
    install_requires=[ # 패키지 설치 시 같이 설치되도록 설정
        "torch==2.7.0",
        "torchaudio==2.7.0",
        "torchvision==0.22.0",
        "pandas==2.2.3",
        "psutil==7.0.0",
        "tqdm==4.67.1"
    ],
    # install_requires=[
	#    "pandas>=1.3.0,<2.0.0",  # 버전 범위 설정 방법
	# ],
    author="Kimyh",
    author_email="kim_yh663927@naver.com",
    description="description",
    long_description=open("README.md").read(),
    long_description_content_type="text/markdown",
    # url="https://github.com/Kim-YoonHyun/my_package",  # 깃허브 주소 등
    classifiers=[
        "Programming Language :: Python :: 3",
        "License :: OSI Approved :: MIT License", # 가장 자유로운 라이센스(MIT 대학에서 이름이 유래했을뿐 MIT 가 관리하는 라이센스는 아님)
        "Operating System :: OS Independent",
    ],
    python_requires=">=3.10",  # 최소 지원할 파이썬 버전
)
```

## MANIFEST.in 작성

```python
include mypackage/dir1/temp.json   # 사용하고자 하는 리소스 경로 및 이름
```

### 모듈 내 코드 작성

사용하고자 하는 리소스가 있을시 해당 서브 모듈 내의 코드 작성 방식

```python
import importlib.resources as resources
with resources.open_text('textbasic.basic', 'dictionary.json') as file:
    # JSON 파일을 파싱하여 딕셔너리로 변환
    replace_dict = json.load(file)
```

## pyproject.toml

```toml
[build-system]
requires = ["setuptools", "wheel"]
build-backend = "setuptools.build_meta"
```



## 2.4. dist 폴더 생성

pip install 이 가능해지도록 dist 폴더 생성

```bash
python setup.py sdist bdist_wheel
```

이후 dist 폴더가 생성된 작업디렉토리 내에서 pip install . 하면 해당 패키지가 install 됨
다른 곳에서 할 경우 pip install /home/{path}/{package name} 식으로 하면 됨

이 단계까지는 dist 폴더가 있는 위치에서의 pip install 만 가능할 뿐 어디에서든 pip install 이 가능한 상태는 아님

## 2.5. PyPI 업로드

전 세계 어디에서든 pip install 이 가능하도록 하려면 PyPi 에 업로드가 필요함

### 2.5.1. 관련 패키지 인스톨

```bash
pip install twine
```

### 2.5.2. pypirc 설정

.pypirc 파일 직접 생성 후 내부 설정 진행

```ini
[pypi]
username = __token__
password = <PyPI 사이트에서 생성한 password 값>
```

### 2.5.3. 업로드 진행

```bash
twine upload dist/*
```

이후 어디에서든 pip install 가능해짐

## 2.6. 모듈 간 활용

compare 에서 basic 의 preprocessor 의 함수를 활용하고 싶은 경우

```python
import textbasic.basic.preprocessor as ppm
```

.pyc 는 기본적으로 pip 에서 인식하지 않기 때문에 

setup.py 에서 강제로 인식시키고 MANIFEST.in 에 포함시켜야함
